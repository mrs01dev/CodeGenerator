(function () {
	$(function () {

		var _${{entity_Name_Here}}Table = $('#MainTable');
		var _{{entity_Name_Here}}Service = abp.services.app.{{Entity_Name_Here}};

		var _permissions = {			
			create: abp.auth.hasPermission('{{App_Area_Name_Here}}.{{Entity_Name_Here}}.Create'),
			edit: abp.auth.hasPermission('{{App_Area_Name_Here}}.{{Entity_Name_Here}}.Edit'),
			delete: abp.auth.hasPermission('{{App_Area_Name_Here}}.{{Entity_Name_Here}}.Delete')
		};


		var dataTable = _${{entity_Name_Here}}Table.DataTable({
			paging: true, 
			responsive: true,
			serverSide: true,
			processing: true,
			"ajax": {
				"url": abp.appPath + '{{App_Area_Name_Here}}/{{Entity_Name_Here}}/GetAll',
				"type": "POST",				
				"dataSrc": "data"
			},
			columnDefs: [
				{
					width: 8,
					data: null,
					"visible": _permissions.edit,
					orderable: false,
					"targets": 0,
					"defaultContent":'<a href="#" class="waves-effect edit"><i class="material-icons">edit</i></a>'

				},
				{{Property_Looped_Template_Here}}
				
				{
					width: 8,
					targets: -1,
					data: null,
					orderable: false,
					"visible": _permissions.delete,
					"defaultContent": '<a href="#" class="waves-effect delete"><i class="material-icons">delete_sweep</i></a>'
				}]
		});
		$('#MainTable tbody').on('click', '[class*=delete]', function () {
			var data = dataTable.row($(this).parents('tr')).data();
			var label = '#' + data.id;
			delete{{Entity_Name_Here}}(data.id, label);
		});
		$('#MainTable tbody').on('click', '[class*=edit]', function () {
			var data = dataTable.row($(this).parents('tr')).data();
			var label = '{{Entity_Name_Here}} #' + data.id;
			var _url = abp.appPath + '{{App_Area_Name_Here}}/{{Entity_Name_Here}}/CreateOrEdit/' + data.id;
			location.href = _url;
		});


		function refreshData() {
			dataTable.ajax.reload();
		}

		$('#RefreshButton').click(function () {
			refreshData();
		});

		$(document).keypress(function (e) {
			if (e.which === 13) {
				refreshData();
			}
		});


		function delete{{Entity_Name_Here}}(id, label) {
			abp.message.confirm(
                abp.utils.formatString(abp.localization.localize('AreYouSureWantToDelete', 'ETESystem'), label),
				function (isConfirmed) {
					if (isConfirmed) {
						_{{entity_Name_Here}}Service.delete({
							id: id
						}).done(function () {
							abp.notify.success(abp.localization.localize('{{Entity_Name_Here}}Deleted'));							
							refreshData;
						});
					}
				}
			);
		}
	});
})();